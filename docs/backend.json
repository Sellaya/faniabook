{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile in the FaniaBook application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        },
        "preferences": {
          "type": "string",
          "description": "User's preferences (e.g., communication preferences, service preferences)."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "phone"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a user for a makeup service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Booking)"
        },
        "serviceType": {
          "type": "string",
          "description": "Type of makeup service booked (Bridal, Semi-Bridal, Party Makeup, Classes)."
        },
        "isStudio": {
          "type": "boolean",
          "description": "Indicates if the service is in-studio (true) or mobile (false)."
        },
        "appointmentDateTime": {
          "type": "string",
          "description": "Date and time of the appointment.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "Location of the service (address for mobile, studio for in-studio)."
        },
        "quote": {
          "type": "number",
          "description": "The price quote for the booking."
        },
        "paymentStatus": {
          "type": "string",
          "description": "Status of the payment (e.g., pending, completed, refunded)."
        },
        "contractId": {
          "type": "string",
          "description": "Reference to Contract. (Relationship: Contract 1:1 Booking)"
        }
      },
      "required": [
        "id",
        "userId",
        "serviceType",
        "isStudio",
        "appointmentDateTime",
        "location",
        "quote",
        "paymentStatus"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review given by a user for a service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Review)"
        },
        "bookingId": {
          "type": "string",
          "description": "Reference to Booking. (Relationship: Booking 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user (e.g., 1 to 5 stars)."
        },
        "comment": {
          "type": "string",
          "description": "Text comment provided by the user in the review."
        },
        "reviewDateTime": {
          "type": "string",
          "description": "Date and time when the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "bookingId",
        "rating",
        "comment",
        "reviewDateTime"
      ]
    },
    "AiReviewSummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiReviewSummary",
      "type": "object",
      "description": "Represents a summary of user reviews generated by AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI review summary."
        },
        "reviewIds": {
          "type": "array",
          "description": "Reference to Review. (Relationship: Review 1:N AiReviewSummary)",
          "items": {
            "type": "string"
          }
        },
        "summary": {
          "type": "string",
          "description": "The summarized text of the reviews generated by AI."
        },
        "generationDateTime": {
          "type": "string",
          "description": "Date and time when the AI summary was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "reviewIds",
        "summary",
        "generationDateTime"
      ]
    },
    "Contract": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Contract",
      "type": "object",
      "description": "Represents a legal agreement between the service provider and the user for a booking.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the contract."
        },
        "bookingId": {
          "type": "string",
          "description": "Reference to Booking. (Relationship: Booking 1:1 Contract)"
        },
        "contractText": {
          "type": "string",
          "description": "The full text content of the contract."
        },
        "acceptanceDateTime": {
          "type": "string",
          "description": "Date and time when the user accepted the contract.",
          "format": "date-time"
        },
        "signature": {
          "type": "string",
          "description": "Digital signature or confirmation of acceptance of the contract."
        }
      },
      "required": [
        "id",
        "bookingId",
        "contractText",
        "acceptanceDateTime",
        "signature"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profiles. Only the authenticated user can read or write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user.  Matches the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores bookings made by a user. Only the authenticated user can read or write their own bookings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique ID of the booking."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews for a specific booking made by a user. Only the authenticated user can read or write their own reviews.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique ID of the booking."
            },
            {
              "name": "reviewId",
              "description": "The unique ID of the review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}/contracts/{contractId}",
        "definition": {
          "entityName": "Contract",
          "schema": {
            "$ref": "#/backend/entities/Contract"
          },
          "description": "Stores contracts associated with a specific booking. Only the authenticated user can read or write their own contracts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "bookingId",
              "description": "The unique ID of the booking."
            },
            {
              "name": "contractId",
              "description": "The unique ID of the contract."
            }
          ]
        }
      },
      {
        "path": "/ai_review_summaries/{aiReviewSummaryId}",
        "definition": {
          "entityName": "AiReviewSummary",
          "schema": {
            "$ref": "#/backend/entities/AiReviewSummary"
          },
          "description": "Stores AI-generated summaries of reviews. This collection requires separate security considerations based on the intended access patterns.",
          "params": [
            {
              "name": "aiReviewSummaryId",
              "description": "The unique ID of the AI review summary."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support FaniaBook's core features, including user profile management, booking services, review system, and contract generation, while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling.  \n\n*   **User Profiles:** Stored under `/users/{userId}/profile` to provide private data that is exclusively controlled by the user.\n*   **Bookings:** Stored under `/users/{userId}/bookings/{bookingId}`.  This hierarchical path enforces that bookings are owned and managed by the user.\n*   **Reviews:** Reviews are stored under `/users/{userId}/bookings/{bookingId}/reviews/{reviewId}`.  This continues the hierarchical path, clearly associating reviews with a specific booking and user. The AI Review Summaries references these reviews.\n*   **Contracts:** Stored under `/users/{userId}/bookings/{bookingId}/contracts/{contractId}`. This follows the hierarchical ownership model from users to bookings to contracts, guaranteeing a clear ownership structure.\n\n**Authorization Independence (CRITICAL):** This design avoids `get()` calls in security rules by leveraging path-based ownership for all user-related data. Since bookings, reviews, and contracts are subcollections of `/users/{userId}`, security rules can directly check `request.auth.uid == userId` to verify ownership without needing to read the parent document.\n\n**QAPs (Rules are not Filters):** This structure supports secure `list` operations. Listing bookings or reviews is always scoped to a specific user ID (`/users/{userId}/bookings`) using path-based ownership, which makes QAPs possible."
  }
}